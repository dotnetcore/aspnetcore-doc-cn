---
title: ASP.NET Core MVC ä¸ EF Core - å®ç°CRUD - 2 of 10 | Microsoft æ–‡æ¡£ï¼ˆæ°‘é—´æ±‰åŒ–ï¼‰
author: tdykstra
description: 
keywords: ASP.NET Core, Entity Framework Core, CRUD, è¯»å–, read, æ›´æ–°, åˆ é™¤
ms.author: tdykstra
manager: wpickett
ms.date: 03/15/2017
ms.topic: get-started-article
ms.assetid: 6e1cd570-40f1-4b24-8b6e-7d2d27758f18
ms.technology: aspnet
ms.prod: asp.net-core
uid: data/ef-mvc/crud
---
# Create, Read, Update, and Delete - EF Core with ASP.NET Core MVC tutorial (2 of 10)

ä½œè€… [Tom Dykstra](https://github.com/tdykstra) ã€ [Rick Anderson](https://twitter.com/RickAndMSFT)

Contoso å¤§å­¦ Webåº”ç”¨ç¨‹åºæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Entity Framework Core 1.1 ä»¥åŠ Visual Studio 2017 æ¥åˆ›å»º ASP.NET Core 1.1 MVC Web åº”ç”¨ç¨‹åºã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ [ç¬¬ä¸€èŠ‚æ•™ç¨‹](intro.md).

åœ¨ä¹‹å‰çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Entity Framework åŠ SQL Server LocalDB åˆ›å»ºäº†ä¸€ä¸ªç”¨æ¥å­˜å‚¨å’Œæ˜¾ç¤ºæ•°æ®çš„MVCåº”ç”¨ç¨‹åºã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä½ å°†å®¡é˜…å¹¶å®šä¹‰ MVC åŸºæ¶åœ¨æ§åˆ¶å™¨å’Œè§†å›¾ä¸­è‡ªåŠ¨ä¸ºæ‚¨åˆ›å»ºçš„ CRUD (åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤)ä»£ç ã€‚

> [!NOTE] 
> æŒ‰ç…§æƒ¯ä¾‹æˆ‘ä»¬åº”è¯¥å®ç°ä»“å‚¨æ¨¡å¼ï¼Œå³åœ¨ä½ çš„æ§åˆ¶å™¨å’Œæ•°æ®å­˜å–å±‚ä¹‹é—´åˆ›å»ºä¸€ä¸ªæŠ½è±¡å±‚æ¥å­˜å–æ•°æ®ã€‚ä½†æ˜¯ä¸ºäº†ä¿æŒæ•™ç¨‹çš„ç®€æ´å¹¶å°†æ³¨æ„åŠ›èšç„¦åœ¨å¦‚ä½•ä½¿ç”¨ Entity Framework æœ¬èº«ï¼Œæˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­æ²¡æœ‰ä½¿ç”¨ä»“å‚¨æ¨¡å¼ã€‚æ›´å¤šçš„ä¿¡æ¯è¯·å‚é˜… [æœ€åä¸€èŠ‚æ•™ç¨‹](advanced.md)ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä½ å°†å»ºç«‹ä»¥ä¸‹Webé¡µé¢ï¼š

![Student Details page](crud/_static/student-details.png)

![Student Create page](crud/_static/student-create.png)

![Student Edit page](crud/_static/student-edit.png)

![Student Delete page](crud/_static/student-delete.png)

## åˆ›å»ºä¸€ä¸ªè¯¦ç»†é¡µé¢

åŸºæ¶ä»£ç å°† `Enrollments` å±æ€§æ’é™¤åœ¨å­¦ç”Ÿç´¢å¼•é¡µé¢å¤–ï¼Œå› ä¸ºè¯¥å±æ€§æ˜¯ä¸€ä¸ªé›†åˆã€‚åœ¨ **è¯¦ç»†** é¡µé¢ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ HTML è¡¨æ ¼ä¸­æ˜¾ç¤ºé›†åˆä¸­çš„å†…å®¹ã€‚

åœ¨ *Controllers/StudentsController.cs* ä»£ç ä¸­ï¼Œè¯¦ç»†è§†å›¾çš„ action æ–¹æ³•ä½¿ç”¨ `SingleOrDefaultAsync` æ–¹æ³•æ¥è¯»å–å•ä¸ª `Student` å®ä½“ã€‚ æŒ‰ç…§ä¸‹é¢çš„é«˜äº®ä»£ç æ·»åŠ ä»£ç è°ƒç”¨ `Include`. `ThenInclude`ï¼Œ ä»¥åŠ `AsNoTracking` æ–¹æ³•ã€‚

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Details&highlight=8-12)]

 `Include` å’Œ `ThenInclude` æ–¹æ³•ä¼šå¯¼è‡´ context åŠ è½½ `Student.Enrollments` å¯¼èˆªå±æ€§ï¼Œå¹¶ä¸”æ¯ä¸ª Enrollment çš„ `Enrollment.Course` å¯¼èˆªå±æ€§ä¹Ÿä¼šåŠ è½½ã€‚ å…³äºè¿™ä¸ªæ–¹æ³•çš„æ›´å¤šå†…å®¹è¯·å‚è€ƒ [è¯»å–å…³è”æ•°æ®](read-related-data.md) æ•™ç¨‹ã€‚

â€œAsNoTrackingâ€ æ–¹æ³•åœ¨å½“å‰ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸå†…è¿”å›çš„å®ä½“ä¸ä¼šæ›´æ–°çš„æƒ…å†µä¸‹å¯ä»¥æé«˜æ€§èƒ½ï¼Œåœ¨æœ¬æ•™ç¨‹æœ€åä½ å¯ä»¥äº†è§£æ›´å¤šå…³äº `AsNoTracking` çš„ä¿¡æ¯ã€‚

### è·¯ç”±æ•°æ®

ä¼ é€’ç»™ `Details` æ–¹æ³•çš„é”®å€¼æ¥è‡ª **è·¯ç”±æ•°æ®** ï¼Œè·¯ç”±æ•°æ®æ˜¯æ¨¡å‹ç»‘å®šå™¨åœ¨ URL æ®µä¸­æ‰¾åˆ°çš„æ•°æ®ã€‚ ä¾‹å¦‚ï¼Œé»˜è®¤è·¯ç”±æŒ‡å®šcontrollerï¼Œaction ä»¥åŠ idæ®µï¼š

[!code-csharp[Main](intro/samples/cu/Startup.cs?name=snippet_RouteAndSeed&highlight=5)]

åœ¨ä¸‹é¢ URL ä¸­ï¼Œé»˜è®¤è·¯ç”±å°† Instructor ä½œä¸ºæ§åˆ¶å™¨ï¼ŒIndex ä½œä¸º actionï¼Œå°† 1 ä½œä¸º id; è¿™äº›å°±æ˜¯è·¯ç”±æ•°æ®çš„å€¼ã€‚

```
http://localhost:1230/Instructor/Index/1?courseID=2021
```
 

URL çš„æœ€åä¸€éƒ¨åˆ† ("?courseID=2021") æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²å€¼ã€‚ å¦‚æœå°†å®ƒä½œä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²å€¼ä¼ é€’ï¼Œæ¨¡å‹ç»‘å®šå™¨ä¹Ÿä¼šå°† I Dçš„å€¼ä¼ é€’ç»™ `Details` æ–¹æ³• `id` å‚æ•°ï¼š

```
http://localhost:1230/Instructor/Index?id=1&CourseID=2021
```

åœ¨ç´¢å¼•é¡µé¢ä¸­ï¼Œè¶…é“¾æ¥ URL ç”± Razor è§†å›¾ä¸­çš„ tag helper è¯­æ³•åˆ›å»ºã€‚ åœ¨ä»¥ä¸‹ Razor ä»£ç ä¸­ï¼Œ `id` å‚æ•°ä¸é»˜è®¤è·¯ç”±åŒ¹é…ï¼Œæ‰€ä»¥ `id` è¢«æ·»åŠ åˆ°è·¯ç”±æ•°æ®ä¸­ã€‚

```html
<a asp-action="Edit" asp-route-id="@item.ID">Edit</a>
```

å½“ `item.ID` ä¸º6æ—¶ï¼Œä¼šç”Ÿæˆä»¥ä¸‹HTMLï¼š

```html
<a href="/Students/Edit/6">Edit</a>
```
åœ¨ä»¥ä¸‹çš„ Razor ä»£ç ä¸­ï¼Œ `studentID` ä¸é»˜è®¤è·¯ç”±ä¸­çš„å‚æ•°ä¸åŒ¹é…ï¼Œå› æ­¤å®ƒè¢«æ·»åŠ ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚
In the following Razor code, `studentID` doesn't match a parameter in the default route, so it's added as a query string.

```html
<a asp-action="Edit" asp-route-studentID="@item.ID">Edit</a>
```

å½“ `item.ID` ä¸º6æ—¶ï¼Œä¼šç”Ÿæˆä»¥ä¸‹HTMLï¼š

```html
<a href="/Students/Edit?studentID=6">Edit</a>
```

æ›´å¤šå…³äº tag helpers çš„ä¿¡æ¯ï¼Œ è¯·å‚è€ƒ [ASP.NET Core çš„ Tag helpers](xref:mvc/views/tag-helpers/intro).

### æ·»åŠ  enrollments åˆ°è¯¦ç»†è§†å›¾

æ‰“å¼€ *Views/Students/Details.cshtml*ï¼Œæ¯ä¸ªå­—æ®µéƒ½æ˜¯ä½¿ç”¨ `DisplayNameFor` ä»¥åŠ `DisplayFor` helper æ¥å‘ˆç°çš„ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=13-18&highlight=2,5)]

åœ¨æœ€åä¸€ä¸ªå­—æ®µä¹‹åï¼Œå¹¶ä¸”åœ¨å…³é—­ `</dl>` æ ‡è®°ä¹‹å‰ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ä»¥æ¥æ˜¾ç¤º enrollments åˆ—è¡¨ï¼š

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=31-52)]

ç²˜è´´ä»£ç åï¼Œå¦‚æœä»£ç å‡ºç°ç¼©è¿›é”™è¯¯ï¼Œè¯·ä½¿ç”¨ CTRL-K-D å¿«æ·é”®è¿›è¡Œæ›´æ­£ã€‚

è¿™æ®µä»£ç éå† `Enrollments` å¯¼èˆªå±æ€§ä¸­çš„å®ä½“ã€‚ å¯¹äºæ¯ä¸ª enrollmentï¼Œå®ƒå°†æ˜¾ç¤ºè¯¾ç¨‹æ ‡é¢˜å’Œæˆç»©ã€‚ è¯¾ç¨‹æ ‡é¢˜æ˜¯ä»å­˜å‚¨åœ¨ Enrollments å®ä½“ä¸­çš„ `Course` å¯¼èˆªå±æ€§ä¸­çš„è¯¾ç¨‹å®ä½“ä¸­æ£€ç´¢å‡ºæ¥çš„ã€‚

è¿è¡Œåº”ç”¨ç¨‹åºï¼Œé€‰æ‹© **Students** é€‰é¡¹å¡ï¼Œç„¶åå•å‡»å­¦ç”Ÿçš„ **Details** é“¾æ¥ã€‚ æ‚¨ä¼šçœ‹åˆ°æ‰€é€‰å­¦ç”Ÿçš„è¯¾ç¨‹å’Œæˆç»©åˆ—è¡¨ï¼š

![Student Details page](crud/_static/student-details.png)

## æ›´æ–°åˆ›å»ºé¡µé¢

åœ¨  *StudentsController.cs* ä¸­ï¼Œé€šè¿‡æ·»åŠ ä¸€ä¸ª try-catch ä»£ç å—å¹¶ä» `Bind` å±æ€§ä¸­ç§»é™¤ ID æ¥ä¿®æ”¹ HttpPost `Create` æ–¹æ³•ã€‚

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=4,6-7,14-21)]

è¿™æ®µä»£ç å°†ç”± ASP.NET MVC æ¨¡å‹ç»‘å®šå™¨åˆ›å»ºçš„ Student å®ä½“æ·»åŠ åˆ° Students å®ä½“é›†ï¼Œç„¶åå°†æ›´æ”¹ä¿å­˜åˆ°æ•°æ®åº“ã€‚ ï¼ˆæ¨¡å‹ç»‘å®šå™¨æ˜¯æŒ‡ ASP.NET MVC åŠŸèƒ½ï¼Œä½¿æ‚¨æ›´å®¹æ˜“å¤„ç†è¡¨å•æäº¤çš„æ•°æ®;æ¨¡å‹ç»‘å®šå™¨å°†å‘å¸ƒçš„è¡¨å•å€¼è½¬æ¢ä¸º CLR ç±»å‹ï¼Œå¹¶å°†è¿™äº›å€¼ä¼ é€’ç»™æ“ä½œæ–¹æ³•ä¸­çš„å‚æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ æ¨¡å‹ç»‘å®šå™¨ä½¿ç”¨ Form é›†åˆä¸­çš„å±æ€§å€¼å®ä¾‹åŒ–æ‚¨çš„ Student å®ä½“ã€‚ï¼‰

æ‚¨ä» `Bind` å±æ€§ä¸­åˆ é™¤äº† `ID` ï¼Œå› ä¸º ID æ˜¯å½“æ’å…¥è¡Œæ—¶ SQL Server æ•°æ®åº“å°†è¢«è‡ªåŠ¨è®¾ç½®çš„ä¸»é”®å€¼ã€‚ ç”¨æˆ·çš„æ— éœ€è¾“å…¥æˆ–è€…è®¾ç½® ID å€¼ã€‚

é™¤äº† `Bind` å±æ€§ä¹‹å¤–ï¼Œä½ åªéœ€è¦ä¿®æ”¹åŸºæ¶ä»£ç ä¸­çš„ try-catch ä»£ç å—ã€‚ å¦‚æœåœ¨ä¿å­˜æ›´æ”¹æ—¶æ•è· `DbUpdateException` çš„å¼‚å¸¸ï¼Œåˆ™ä¼šæ˜¾ç¤ºä¸€èˆ¬çš„é”™è¯¯æ¶ˆæ¯ã€‚ `DbUpdateException` å¼‚å¸¸æœ‰æ—¶ç”±åº”ç”¨ç¨‹åºå¤–éƒ¨å› ç´ å¼•èµ·ï¼Œè€Œä¸æ˜¯ç¨‹åºæœ¬èº«é”™è¯¯ï¼Œæ‰€ä»¥å»ºè®®ç”¨æˆ·å†è¯•ä¸€æ¬¡ã€‚ è™½ç„¶åœ¨æ­¤ç¤ºä¾‹ä¸­æœªå®ç°ï¼Œä½†ç”Ÿäº§ç¯å¢ƒçš„åº”ç”¨ç¨‹åºå°†è®°å½•å¼‚å¸¸ã€‚ æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…
[ç›‘æ§å’Œé¥æµ‹ (åœ¨ Azure æ„å»ºçœŸå®ä¸–ç•Œäº‘åº”ç”¨ç¨‹åº)](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry)ä¸­çš„ **æ—¥å¿—æ´å¯Ÿ** ç« èŠ‚ã€‚

`ValidateAntiForgeryToken` å±æ€§æœ‰åŠ©äºé˜²æ­¢è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ”»å‡»ã€‚ ä»¤ç‰Œä¼šç”± [FormTagHelper](xref:mvc/views/working-with-forms#the-form-tag-helper) è‡ªåŠ¨æ³¨å…¥åˆ°è§†å›¾ä¸­ï¼Œå¹¶åœ¨ç”¨æˆ·æäº¤è¡¨å•æ—¶åŒ…å«è¯¥ä»¤ç‰Œã€‚ ä»¤ç‰Œä¼šè¢« `ValidateAntiForgeryToken` å±æ€§éªŒè¯ã€‚ æœ‰å…³CSRFçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [ğŸ”§ åè¯·æ±‚ä¼ªé€ ](../../security/anti-request-forgery.md).

<a id="overpost"></a>
### å…³äº overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„å®‰å…¨è¯´æ˜

 åŸºæ¶ä»£ç ä¸­çš„ `Create` æ–¹æ³•ä¸­åŒ…å«çš„ `Bind` å±æ€§æ˜¯åœ¨åˆ›å»ºæ–¹æ¡ˆä¸­é˜²æ­¢overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„ä¸€ç§æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾å­¦ç”Ÿå®ä½“åŒ…å«ä¸€ä¸ª `Secret` å±æ€§ï¼Œä½†æ˜¯æ‚¨åˆä¸å¸Œæœ›æ­¤å±æ€§åœ¨ç½‘é¡µè¿›è¡Œè®¾ç½®ã€‚

```csharp
public class Student
{
    public int ID { get; set; }
    public string LastName { get; set; }
    public string FirstMidName { get; set; }
    public DateTime EnrollmentDate { get; set; }
    public string Secret { get; set; }
}
```

å³ä½¿æ‚¨çš„ç½‘é¡µä¸Šæ²¡æœ‰ `Secret` å­—æ®µï¼Œé»‘å®¢ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¸å¦‚ Fiddler ä¹‹ç±»çš„å·¥å…·ï¼Œæˆ–è€…å†™ä¸€äº› JavaScript æ¥ Post ä¸€ä¸ª `Secret` è¡¨å•å€¼ã€‚ æ²¡æœ‰ `Bind` å±æ€§é™åˆ¶æ¨¡å‹ç»‘å®šå™¨åˆ›å»º Student å®ä¾‹æ—¶ä½¿ç”¨çš„å­—æ®µï¼Œæ¨¡å‹ç»‘å®šå™¨å°†æŠ“å– `Secret` è¡¨å•å€¼ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»ºå­¦ç”Ÿå®ä½“å®ä¾‹ã€‚ä¸ç®¡é»‘å®¢ä¸º `Secret` è¡¨å•åŸŸæŒ‡å®šçš„ä»€ä¹ˆå€¼éƒ½å°†åœ¨æ•°æ®åº“ä¸­è¢«æ›´æ–°ã€‚ ä»¥ä¸‹å›¾åƒæ˜¾ç¤ºäº†Fiddlerå·¥å…·å°† `Secret` å­—æ®µï¼ˆå¸¦æœ‰â€œOverPostâ€ï¼‰æ·»åŠ åˆ°å‘å¸ƒçš„è¡¨å•å€¼ã€‚

![Fiddler adding Secret field](crud/_static/fiddler.png)

ç„¶å"OverPost" çš„å€¼å°†æˆåŠŸæ·»åŠ åˆ°æ’å…¥åˆ°æ•°æ®è¡Œçš„ `Secret` å±æ€§ï¼Œå°½ç®¡æ‚¨ä»æœªæ‰“ç®—é€šè¿‡ç½‘é¡µå¯ä»¥è®¾ç½®è¯¥å±æ€§ã€‚
 
æ‚¨å¯ä»¥å…ˆé€šè¿‡å…ˆä»æ•°æ®åº“ä¸­è¯»å–å®ä½“ï¼Œç„¶åè°ƒç”¨ `TryUpdateModel` æ–¹æ³•ï¼Œæ˜¾å¼çš„ä¼ é€’ä¸€ä¸ªå…è®¸çš„å±æ€§åˆ—è¡¨ï¼Œä»è€Œé˜²æ­¢ç¼–è¾‘åœºæ™¯ä¸­çš„overpostï¼ˆè¿‡åº¦æäº¤ï¼‰ã€‚ è¿™æ˜¯è¿™äº›æ•™ç¨‹ä¸­ä½¿ç”¨çš„æ–¹æ³•ã€‚

è®¸å¤šå¼€å‘äººå‘˜é¦–é€‰çš„é˜²æ­¢overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨è§†å›¾æ¨¡å‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ¨¡å‹ç»‘å®šçš„å®ä½“ç±»ã€‚ åœ¨è§†å›¾æ¨¡å‹ä¸­ä»…åŒ…å«è¦æ›´æ–°çš„å±æ€§ã€‚ ä¸€æ—¦ MVC æ¨¡å‹ç»‘å®šå®Œæˆï¼Œå°†è§†å›¾æ¨¡å‹å±æ€§å¤åˆ¶åˆ°å®ä½“å®ä¾‹ï¼Œå¯é€‰åœ°ä½¿ç”¨è¯¸å¦‚   AutoMapper ä¹‹ç±»çš„å·¥å…·ã€‚ åœ¨å®ä½“å®ä¾‹ä¸Šä½¿ç”¨ `_context.Entry` å°†å…¶çŠ¶æ€è®¾ç½®ä¸º `Unchanged`ï¼Œç„¶ååœ¨è§†å›¾æ¨¡å‹ä¸­åŒ…å«çš„æ¯ä¸ªå®ä½“å±æ€§ä¸Šè®¾ç½® `Property("PropertyName").IsModified` ä¸ºtrueã€‚ æ­¤æ–¹æ³•é€‚ç”¨äºç¼–è¾‘å’Œåˆ›å»ºåœºæ™¯ã€‚

### æµ‹è¯•åˆ›å»ºé¡µé¢

*Views/Students/Create.cshtml* ä¸­ ä¸­çš„ä»£ç ä¸ºæ¯ä¸ªå­—æ®µä½¿ç”¨ `label`ï¼Œ `input`ï¼Œ ä»¥åŠ `span` (ç”¨äºéªŒè¯æ¶ˆæ¯) tag helpersã€‚

è¿è¡Œé¡µé¢é€‰æ‹© **Students** é€‰é¡¹å¼€å¹¶ç‚¹å‡» **Create New**ã€‚

è¾“å…¥å§“åå’Œéæ³•æ—¥æœŸç‚¹å‡» **Create** ä¼šå‡ºç°é”™è¯¯ä¿¡æ¯ã€‚

![Date validation error](crud/_static/date-error.png)

è¿™æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºé»˜è®¤çš„æœåŠ¡å™¨ç«¯éªŒè¯; åœ¨åé¢çš„æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä½•æ·»åŠ å°†ç”Ÿæˆå®¢æˆ·ç«¯éªŒè¯ä»£ç çš„å±æ€§ã€‚ ä»¥ä¸‹é«˜äº®æ˜¾ç¤ºçš„ä»£ç æ˜¾ç¤ºäº† `Create` æ–¹æ³•ä¸­çš„æ¨¡å‹éªŒè¯æ£€æŸ¥ã€‚

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=8)]

å°†æ—¥æœŸæ›´æ”¹ä¸ºæœ‰æ•ˆå€¼ï¼Œç„¶åå•å‡» **Create** å¹¶åœ¨**Index** é¡µé¢ä¸­æŸ¥çœ‹æ–°æ·»åŠ å­¦ç”Ÿã€‚

## æ›´æ–°ç¼–è¾‘é¡µé¢

åœ¨ *StudentController.cs*ä¸­ï¼ŒHttpGet `Edit` æ–¹æ³•(æ²¡æœ‰ `HttpPost` ç‰¹æ€§çš„é‚£ä¸€ä¸ª)ä½¿ç”¨ `SingleOrDefaultAsync`æ–¹æ³•æ¥æ£€ç´¢æ‰€é€‰æ‹©çš„ Student å®ä½“ï¼Œæ­£å¦‚ä½ åœ¨ `Details` æ–¹æ³•ä¸­çœ‹åˆ°çš„ä¸€æ ·ã€‚æ‚¨ä¸éœ€è¦æ›´æ–°æ­¤æ–¹æ³•ã€‚

### æ¨è HttpPost Edit ä»£ç ï¼šè¯»å–å¹¶ä¸”æ›´æ–°

ç”¨ä¸‹åˆ—ä»£ç æ›¿æ¢ HttpPost Edit action æ–¹æ³•ã€‚

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_ReadFirst)]

è¿™ä¸ªæ”¹åŠ¨æ˜¯å®ç°é˜²æ­¢overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„æœ€ä½³å®è·µã€‚ åŸºæ¶ç”Ÿæˆä¸€ä¸ª `Bind` å±æ€§ï¼Œå¹¶å°†ç”±æ¨¡å‹ç»‘å®šå™¨åˆ›å»ºçš„å®ä½“æ·»åŠ åˆ°å…·æœ‰ `Modified` æ ‡å¿—çš„å®ä½“é›†ä¸­ã€‚ è¯¥ä»£ç ä¸æ¨èç”¨äºæ‰€æœ‰åœºæ™¯ï¼Œå› ä¸º `Bind` å±æ€§ä¼šæ¸…é™¤æœªåŒ…å«åœ¨ `Include` å‚æ•°ä¸­çš„ä»»ä½•é¢„å…ˆå­˜åœ¨çš„æ•°æ®ã€‚  

æ–°çš„ä»£ç è¯»å–ç°æœ‰å®ä½“ï¼Œå¹¶è°ƒç”¨ `TryUpdateModel` æ–¹æ³•æ¥æ›´æ–°ç”¨æˆ·åœ¨æäº¤è¡¨å•æ•°æ®ä¸­è¾“å…¥çš„æ•°æ®å¯¹åº”åˆ°å®ä½“ä¸­çš„å­—æ®µã€‚ Entity Framework è‡ªåŠ¨æ›´æ”¹è·Ÿè¸ªåœ¨é€šè¿‡è¡¨å•è¾“å…¥æ›´æ”¹çš„å­—æ®µä¸Šè®¾ç½® `Modified` æ ‡å¿—ã€‚ å½“è°ƒç”¨`SaveChanges`æ–¹æ³•æ—¶ï¼ŒEntity Frameworkä¼šåˆ›å»ºSQLè¯­å¥æ¥æ›´æ–°æ•°æ®åº“è¡Œã€‚ å¿½ç•¥å¹¶å‘å†²çªï¼Œåªæœ‰ç”¨æˆ·æ›´æ–°çš„è¡¨åˆ—åœ¨æ•°æ®åº“ä¸­æ›´æ–°ã€‚ ï¼ˆç¨åçš„æ•™ç¨‹å°†æ˜¾ç¤ºå¦‚ä½•å¤„ç†å¹¶å‘å†²çªã€‚ï¼‰

ä½œä¸ºé˜²æ­¢overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„æœ€ä½³å®è·µï¼Œæ‚¨å¯ä»¥é€šè¿‡æŠŠ **Edit** é¡µé¢æ›´æ–°çš„å­—æ®µåˆ—å…¥ `TryUpdateModel` å‚æ•°çš„ç™½åå•åˆ—è¡¨ã€‚ ï¼ˆå‚æ•°åˆ—è¡¨ä¸­çš„å­—æ®µåˆ—è¡¨ä¹‹å‰çš„ç©ºå­—ç¬¦ä¸²æ˜¯ç”¨äºå®šä¹‰è¡¨å•å­—æ®µåç§°çš„å‰ç¼€çš„ã€‚ï¼‰ç›®å‰æ²¡æœ‰è¦ä¿æŠ¤çš„é¢å¤–å­—æ®µï¼Œä½†åˆ—å‡ºäº†æ‚¨å¸Œæœ›æ¨¡å‹ç»‘å®šå™¨ç»‘å®šçš„å­—æ®µ è¿™æ ·å¯ä»¥ç¡®ä¿æ‚¨å°†æ¥ä¸ºæ•°æ®æ¨¡å‹æ·»åŠ å­—æ®µçš„æ—¶å€™ï¼Œå®ƒä»¬å°†è‡ªåŠ¨å—åˆ°ä¿æŠ¤ï¼Œç›´åˆ°æ‚¨åœ¨æ­¤å¤„æ˜¾å¼æ·»åŠ ã€‚

ä½œä¸ºæ›´æ”¹çš„ç»“æœï¼Œå› ä¸ºHttpPost `Edit` æ–¹æ³•çš„æ–¹æ³•ç­¾åä¸HttpGet `Edit` æ–¹æ³•ç›¸åŒ; æ‰€ä»¥éœ€è¦æŠŠæ–¹æ³•é‡å‘½åä¸º `EditPost`çš„æ–¹æ³•ã€‚

### å¦ä¸€ä¸ª HttpPost Edit ä»£ç ï¼šåˆ›å»ºå¹¶é™„åŠ 

æ¨èçš„ HttpPost ç¼–è¾‘ä»£ç å¯ä»¥ç¡®ä¿ä»…ä»…æ›´æ–°æ›´æ”¹è¿‡çš„åˆ—ï¼Œå¹¶ä¿ç•™ä¸éœ€è¦åŒ…å«åœ¨æ¨¡å‹ç»‘å®šçš„å±æ€§ä¸­çš„æ•°æ®ã€‚ ç„¶è€Œï¼Œé¦–å…ˆè¯»å–çš„æ–¹æ³•éœ€è¦é¢å¤–çš„æ•°æ®åº“è¯»å–æ“ä½œï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´éœ€è¦åŠ å…¥å¤„ç†å¹¶å‘å†²çªçš„æ›´å¤æ‚çš„ä»£ç ã€‚ å¦ä¸€ç§æ–¹æ³•æ˜¯å°†ç”±æ¨¡å‹ç»‘å®šå™¨åˆ›å»ºçš„å®ä½“é™„åŠ åˆ° EF ä¸Šä¸‹æ–‡å¹¶å°†å…¶æ ‡è®°ä¸ºå·²ä¿®æ”¹ã€‚ ï¼ˆä¸è¦ä½¿ç”¨æ­¤ä»£ç æ›´æ–°é¡¹ç›®ï¼Œè¿™ä»…ä»…æ˜¯å¯é€‰æ–¹æ¡ˆã€‚ï¼‰

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_CreateAndAttach)]

å½“ç½‘é¡µ UI åŒ…å«å®ä½“ä¸­çš„æ‰€æœ‰å­—æ®µå¹¶ä¸”å…è®¸æ›´æ–°å®ƒä»¬æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚

The scaffolded code uses the create-and-attach approach but only catches `DbUpdateConcurrencyException` exceptions and returns 404 error codes.  The example shown catches any database update exception and displays an error message.
åŸºæ¶ä»£ç ä½¿ç”¨ create-and-attach æ–¹å¼ï¼Œä½†åªèƒ½æ•è· `DbUpdateConcurrencyException` å¼‚å¸¸å¹¶è¿”å› 404 é”™è¯¯ä»£ç ã€‚ ç¤ºä¾‹å±•ç¤ºæ•è·æ•°æ®åº“æ›´æ–°å¼‚å¸¸å¹¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚



### å®ä½“çŠ¶æ€
 
æ•°æ®åº“ä¸Šä¸‹æ–‡ä¼šè·Ÿè¸ªå†…å­˜ä¸­çš„å®ä½“æ˜¯å¦ä¸æ•°æ®åº“ä¸­çš„æ•°æ®è¡Œä¿æŒåŒæ­¥ã€‚å¹¶æ ¹æ®åŒæ­¥çš„ä¿¡æ¯æ¥ç¡®å®šè°ƒç”¨`SaveChanges` æ–¹æ³•æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä¾‹å¦‚ï¼Œè®©ä½ ä¼ é€’ä¸€ä¸ªæ–°å®ä½“ç»™ `Add` æ–¹æ³•ï¼Œè¯¥å®ä½“çš„çŠ¶æ€è®¾ç½®ä¸º `Added`ã€‚ç„¶åæ‚¨è°ƒç”¨ `SaveChanges` æ–¹æ³•æ—¶ï¼Œæ•°æ®åº“ä¸Šä¸‹æ–‡ä¼šç”Ÿæˆä¸€ä¸ª SQL Insert å‘½ä»¤ä»¥æ’å…¥æ•°æ®ã€‚

ä¸€ä¸ªå®ä½“å¯èƒ½å¤„äºä»¥ä¸‹çŠ¶æ€ï¼š

* `Added`. å®ä½“å°šæœªåœ¨æ•°æ®åº“ä¸­ã€‚ `SaveChanges` æ–¹æ³•å°†äº§ç”Ÿä¸€ä¸ª Insert è¯­å¥ã€‚ 

* `Unchanged`. `SaveChanges` å¯¹è¯¥å®ä½“ä»€ä¹ˆéƒ½ä¸éœ€è¦åšã€‚å½“ä½ ä»æ•°æ®åº“è¯»å‡ºä¸€ä¸ªå®ä½“æ—¶ï¼Œè¯¥å®ä½“å°±ä¸ºè¿™ä¸€çŠ¶æ€ã€‚ 

* `Modified`. æŸäº›æˆ–æ‰€æœ‰å®ä½“çš„å±æ€§å€¼å·²éƒ½è¢«æ›´æ”¹ã€‚ `SaveChanges` å°†äº§ç”Ÿä¸€ä¸ªUpdateè¯­å¥ã€‚ 

* `Deleted`. è¯¥å®ä½“å·²ç»è¢«æ ‡å¿—ä¸ºåˆ é™¤ã€‚ `SaveChanges` å°†äº§ç”Ÿä¸€ä¸ªDeleteè¯­å¥ã€‚ 

* `Detached`. è¯¥å®ä½“æ²¡æœ‰è¢«æ•°æ®åº“ä¸Šä¸‹æ–‡æ‰€è·Ÿè¸ªã€‚

åœ¨æ¡Œé¢åº”ç”¨ç¨‹åºä¸­ï¼ŒçŠ¶æ€å˜åŒ–é€šå¸¸æ˜¯è‡ªåŠ¨è®¾ç½®çš„ã€‚åœ¨æ¡Œé¢å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä½ çœ‹åˆ°ä¸€ä¸ªå®ä½“å¹¶æ›´æ”¹å®ƒçš„ä¸€äº›å±æ€§å€¼ï¼Œå°†å¯¼è‡´å®ƒçš„å®ä½“çŠ¶æ€è‡ªåŠ¨æ›´æ”¹ä¸º `Modified`ã€‚ç„¶åä½ è°ƒç”¨ `SaveChanges`ï¼Œå®ä½“æ¡†æ¶ç”Ÿæˆä¸€ä¸ª SQL Update æ¥æ›´æ–°ä½ è¿›è¡Œäº†å˜æ›´çš„å±æ€§ã€‚

Webåº”ç”¨ç¨‹åºçš„æ–­å¼€è¿æ¥æ€§è´¨ä¸å…è®¸è¿™ç§è¿ç»­åºåˆ—ã€‚ `DbContext` åœ¨è¯»å–åˆ°å®ä½“å¹¶å°†å…¶å‘ˆç°åœ¨é¡µé¢ä¸Šï¼Œä¹‹åä¾¿è¢«é”€æ¯ã€‚å½“ HttpPost `Edit` actionæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¸€ä¸ªæ–°è¯·æ±‚è¢«å¤„ç†ï¼Œä½ å°†è·å–ä¸€ä¸ªæ–°çš„ `DbContext` çš„å®ä¾‹ã€‚æ‰€ä»¥ä½ å¿…é¡»æ‰‹åŠ¨è®¾ç½®å®ä½“çŠ¶æ€ä¸ºModifiedï¼Œç„¶åä½ è°ƒç”¨SaveChangesï¼Œå®ä½“æ¡†æ¶æ›´æ–°æ•°æ®åº“ä¸­çš„æ‰€æœ‰çš„æ•°æ®è¡Œï¼Œå› ä¸ºä¸Šä¸‹æ–‡æ²¡æœ‰åŠæ³•çŸ¥é“é‚£ä¸ªå±æ€§æ˜¯ä½ è¿›è¡Œäº†å˜æ›´çš„ã€‚

åœ¨ Web åº”ç”¨ç¨‹åºä¸­ï¼Œ `DbContext` åˆå§‹åŒ–è¯»å–å®ä½“å¹¶æ˜¾ç¤ºå…¶è¦ç¼–è¾‘çš„æ•°æ®å¹¶åœ¨é¡µé¢æ¸²æŸ“ä¹‹åè‡ªåŠ¨æ–½æ”¾ã€‚ å½“è°ƒç”¨ HttpPost `Edit` action æ–¹æ³•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Webè¯· æ±‚ï¼Œå¯¹åº”åŒ…å«ä¸€ä¸ªæ–°çš„ `DbContext` å®ä¾‹ã€‚ å¦‚æœæ‚¨åœ¨æ–°çš„ä¸Šä¸‹æ–‡ä¸­é‡æ–°è¯»å–äº†å®ä½“ï¼Œåˆ™å¯ä»¥å‚è€ƒæ¡Œé¢å¤„ç†ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¸æƒ³æ‰§è¡Œé¢å¤–çš„è¯»å–æ“ä½œï¼Œåˆ™å¿…é¡»ä½¿ç”¨ç”±æ¨¡å‹ç»‘å®šå™¨åˆ›å»ºçš„å®ä½“å¯¹è±¡ã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†å®ä½“çŠ¶æ€è®¾ç½®ä¸º Modifiedï¼Œå°±åƒå‰é¢æ‰€ç¤ºçš„ HttpPost Edit ä»£ç ä¸­æ‰€åšçš„é‚£æ ·ã€‚ ç„¶åå½“æ‚¨è°ƒç”¨`SaveChanges`æ—¶ï¼ŒEntity Framework å°†æ›´æ–°æ•°æ®åº“è¡Œçš„æ‰€æœ‰åˆ—ï¼Œå› ä¸ºä¸Šä¸‹æ–‡æ— æ³•çŸ¥é“æ‚¨æ›´æ”¹äº†å“ªäº›å±æ€§ã€‚

å¦‚æœä½ ä¸æƒ³ç”¨é¢„å…ˆè¯»å–çš„æ–¹å¼ï¼Œä½ æƒ³åœ¨ SQL Update è¯­å¥åªæ›´æ–°ç”¨æˆ·å®é™…æ›´æ”¹çš„å­—æ®µï¼Œä»£ç ä¼šæ¯”è¾ƒå¤æ‚ï¼Œä½ ä¸å¾—ä¸ä»¥æŸç§æ–¹å¼ä¿å­˜åŸæ¥çš„å€¼(æ¯”å¦‚éšè—å­—æ®µ)ï¼Œè¿™æ ·åœ¨è°ƒç”¨ HttpPost  `Edit`  æ–¹æ³•æ—¶å°±å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨åŸå€¼æ¥åˆ›å»ºä¸€ä¸ª Student å®ä½“ï¼Œè°ƒç”¨åŸå§‹ç‰ˆæœ¬çš„ `Attach` æ–¹æ³•æ›´æ–°å®ä½“çš„å€¼åˆ°æ–°å€¼ï¼Œç„¶åè°ƒç”¨ `SaveChanges`ã€‚

### æµ‹è¯•ç¼–è¾‘é¡µé¢

è¿è¡Œåº”ç”¨ç¨‹åºå¹¶é€‰æ‹© **Students** é€‰é¡¹å¡ï¼Œç„¶åç‚¹å‡» **Edit** é“¾æ¥ã€‚

![Students edit page](crud/_static/student-edit.png)

ä¿®æ”¹éƒ¨åˆ†æ•°æ®å¹¶ä¸”ç‚¹å‡» **Save**ã€‚ é‡æ–°æ‰“å¼€ **Index** é¡µé¢æŸ¥çœ‹ä¿®æ”¹è¿‡çš„æ•°æ®ã€‚

## æ›´æ–°åˆ é™¤é¡µé¢

åœ¨ *StudentController.cs*ä¸­ï¼ŒHttpGet Delete æ–¹æ³•çš„æ¨¡æ¿ä»£ç ä½¿ç”¨ `SingleOrDefaultAsync` æ–¹æ³•æ£€ç´¢æ‰€é€‰çš„Studentå®ä½“ï¼Œæ­£å¦‚ä½ åœ¨ Details å’Œ Edit æ–¹æ³•ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚ç„¶è€Œï¼Œè°ƒç”¨ `SaveChanges` å¤±è´¥æ—¶çš„è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯éœ€è¦ä¿®æ­£ï¼Œæ‚¨å°†ä¸ºæ­¤æ–¹æ³•åŠå…¶å¯¹åº”è§†å›¾æ·»åŠ ä¸€äº›åŠŸèƒ½ã€‚

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„æ›´æ–°å’Œåˆ›å»ºæ“ä½œä¸€æ ·ï¼Œåˆ é™¤æ“ä½œéœ€è¦ä¸¤ä¸ªæ“ä½œæ–¹æ³•ã€‚ å“åº” GET è¯·æ±‚çš„è°ƒç”¨æ–¹æ³•æ˜¾ç¤ºä¸€ä¸ªè§†å›¾ï¼Œç»™äºˆç”¨æˆ·æ‰¹å‡†æˆ–å–æ¶ˆåˆ é™¤æ“ä½œçš„æœºä¼šã€‚ å¦‚æœç”¨æˆ·æ‰¹å‡†ï¼Œåˆ™ä¼šåˆ›å»º POST è¯·æ±‚ã€‚ å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒHttpPost `Delete` æ–¹æ³•è¢«è°ƒç”¨ï¼Œç„¶åè¯¥æ–¹æ³•å®é™…æ‰§è¡Œåˆ é™¤æ“ä½œã€‚

æ‚¨å°†æ·»åŠ ä¸€ä¸ª try-catch ä»£ç å—åˆ° HttpPost `Delete` æ–¹æ³•æ¥å¤„ç†æ•°æ®åº“æ›´æ–°æ—¶å¯èƒ½å‘ç”Ÿçš„ä»»ä½•é”™è¯¯ã€‚ å¦‚æœå‘ç”Ÿé”™è¯¯ï¼ŒHttpPost Delete æ–¹æ³•è°ƒç”¨ HttpGet Delete æ–¹æ³•ï¼Œä¼ é€’ä¸€ä¸ªæŒ‡ç¤ºå‘ç”Ÿé”™è¯¯çš„å‚æ•°ã€‚ HttpGet Deleteæ–¹æ³•ç„¶åé‡æ–°æ˜¾ç¤ºç¡®è®¤é¡µé¢ä»¥åŠé”™è¯¯æ¶ˆæ¯ï¼Œä¸ºç”¨æˆ·æä¾›å–æ¶ˆæˆ–å†æ¬¡å°è¯•çš„æœºä¼šã€‚
 
ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢ HttpGet `Delete` action æ–¹æ³•ï¼Œè¯¥ä»£ç ç®¡ç†é”™è¯¯æŠ¥å‘Šã€‚

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteGet&highlight=1,9,16-21)]

è¿™æ®µä»£ç æ¥å—ä¸€ä¸ªå¯é€‰å‚æ•°ï¼ŒæŒ‡ç¤ºæ–¹æ³•æ˜¯å¦åœ¨ä¿å­˜æ›´æ”¹å¤±è´¥åè¢«è°ƒç”¨ã€‚ å½“ HttpGet `Delete` æ–¹æ³•è¢«è°ƒç”¨è€Œæ²¡æœ‰å…ˆå‰çš„å¤±è´¥æ—¶ï¼Œæ­¤å‚æ•°ä¸ºfalseã€‚ å½“ HttpPost `Delete` æ–¹æ³•å“åº”äºæ•°æ®åº“æ›´æ–°é”™è¯¯è°ƒç”¨è¯¥å‚æ•°æ—¶ï¼Œè¯¥å‚æ•°ä¸ºtrueï¼Œå¹¶å°†é”™è¯¯æ¶ˆæ¯ä¼ é€’ç»™è¯¥è§†å›¾ã€‚

###  read-first approach æ¨¡å¼æ¥ HttpPost åˆ é™¤

ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢ HttpPost `Delete` actionæ–¹æ³•ï¼ˆå‘½åä¸º `DeleteConfirmed`ï¼‰ï¼Œè¯¥ä»£ç æ‰§è¡Œå®é™…çš„åˆ é™¤æ“ä½œå¹¶æ•è·ä»»ä½•æ•°æ®åº“æ›´æ–°é”™è¯¯ã€‚

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithReadFirst&highlight=6,8-11,13-14,18-23)]

æ­¤ä»£ç æ£€ç´¢æ‰€é€‰å®ä½“ï¼Œç„¶åè°ƒç”¨ `Remove` æ–¹æ³•å°†å®ä½“çš„çŠ¶æ€è®¾ç½®ä¸º `Deleted`ã€‚ å½“è°ƒç”¨ `SaveChanges` æ–¹æ³•æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ª SQL DELETE å‘½ä»¤ã€‚

###  create-and-attach æ¨¡å¼æ¥ HttpPost åˆ é™¤

å¦‚æœåœ¨å¤§æ•°æ®åº”ç”¨ç¨‹åºä¸­æé«˜æ€§èƒ½æ˜¯ä¼˜å…ˆçº§ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»…ä½¿ç”¨ä¸»é”®å€¼å®ä¾‹åŒ– Student å®ä½“ï¼Œç„¶åå°†å®ä½“çŠ¶æ€è®¾ç½®ä¸º `Deleted`æ¥é¿å…ä¸å¿…è¦çš„SQLæŸ¥è¯¢ã€‚ è¿™å°±æ˜¯å®ä½“æ¡†æ¶ä¸ºäº†åˆ é™¤å®ä½“è€Œéœ€è¦çš„ã€‚ ï¼ˆä¸è¦æŠŠè¿™æ®µä»£ç æ”¾åœ¨ä½ çš„é¡¹ç›®ä¸­;è¿™é‡Œä»…ä»…ä¸ºäº†è¯´æ˜ä¸€ä¸ªé€‰æ‹©æ–¹æ¡ˆï¼‰

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithoutReadFirst&highlight=7-8)]

å¦‚æœå®ä½“æœ‰ç›¸å…³æ•°æ®ä¹Ÿåº”è¯¥è¢«åˆ é™¤ï¼Œè¯·ç¡®ä¿åœ¨æ•°æ®åº“ä¸­é…ç½®äº†çº§è”åˆ é™¤ã€‚ é€šè¿‡è¿™ç§å®ä½“åˆ é™¤æ–¹æ³•ï¼ŒEF å¯èƒ½æ— æ³•æ„è¯†åˆ°æœ‰å…³è”çš„å®ä½“åº”è¯¥è¢«åˆ é™¤ã€‚

### æµ‹è¯•åˆ é™¤é¡µé¢

åœ¨ *Views/Student/Delete.cshtml* ä¸­ï¼Œåœ¨h2æ ‡é¢˜å’Œh3æ ‡é¢˜ä¹‹é—´æ·»åŠ é”™è¯¯ä¿¡æ¯ï¼ŒæŒ‰ç…§å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

[!code-html[](intro/samples/cu/Views/Students/Delete.cshtml?range=7-9&highlight=2)]

è¿è¡Œé¡µé¢é€‰æ‹© **Students** é€‰é¡¹å¡å¹¶ç‚¹å‡» **Delete** é“¾æ¥ï¼š

![Delete confirmation page](crud/_static/student-delete.png)

ç‚¹å‡» **Delete**ã€‚Index é¡µé¢æ˜¾ç¤ºæœªè¢«åˆ é™¤çš„å­¦ç”Ÿã€‚ ï¼ˆæ‚¨å°†åœ¨å¹¶å‘æ•™ç¨‹ä¸­çœ‹åˆ°å¦‚ä½•å¤„ç†ä»£ç çš„ç¤ºä¾‹ã€‚ï¼‰

## å…³é—­æ•°æ®åº“è¿æ¥

è¦ç¡®ä¿æ•°æ®åº“è¿æ¥æ­£ç¡®çš„å…³é—­å¹¶é‡Šæ”¾æ‰€å ç”¨çš„èµ„æºï¼Œå½“ä½ ä½¿ç”¨å®Œæ•°æ®åº“ä¸Šä¸‹é—®å€™ï¼Œéœ€è¦å°†å…¶é”€æ¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè„šæ‰‹æ¶ä»£ç åœ¨Studentæ§åˆ¶å™¨ç±»çš„æœ€åéƒ¨åˆ†æä¾›äº†ä¸€ä¸ªDisposeæ–¹æ³•ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š

è¦ç¡®ä¿æ–½æ”¾æ•°æ®åº“è¿æ¥å ç”¨çš„èµ„æºï¼Œæ•°æ®åº“ä¸Šä¸‹æ–‡å®ä¾‹å¿…é¡»åœ¨ä½ ç”¨å®Œä»¥åç«‹å³é‡Šæ”¾ã€‚ASP.NET Core å†…ç½®[ä¾èµ–æ³¨å…¥](../../fundamentals/dependency-injection.md) å¯ä»¥å¸®åŠ©ä½ è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

åœ¨ *Startup.cs* ä½ å¯ä»¥è°ƒç”¨ [AddDbContext æ‰©å±•æ–¹æ³•](https://github.com/aspnet/EntityFramework/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs) åœ¨ ASP.NET DI å®¹å™¨ä¸­è®¾ç½® `DbContext` ç±»ã€‚æ–¹æ³•é»˜è®¤æŠŠæœåŠ¡ç”Ÿå‘½å‘¨æœŸè®¾ç½®ä¸º `Scoped`ã€ `Scoped` æ„å‘³ç€ä¸Šä¸‹æ–‡å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå’Œ web è¯·æ±‚ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€è‡´çš„ï¼Œ åœ¨è¯·æ±‚ç»“æŸçš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨ `Dispose` æ–¹æ³•ã€‚

## å¤„ç†äº‹åŠ¡

é»˜è®¤æƒ…å†µä¸‹ï¼ŒEntity Framework éšå¼çš„å®ç°äº‹åŠ¡å¤„ç†ã€‚å½“ä½ å¯¹å¤šä¸ªè¡¨æˆ–è¡Œè¿›è¡Œäº†æ›´æ”¹åè°ƒç”¨ `SaveChanges`ï¼ŒEntity Framework ä¼šè‡ªåŠ¨ç¡®ä¿ä½ çš„æ‰€æœ‰æ›´æ”¹å…¨éƒ¨æˆåŠŸä¿å­˜åˆ°æ•°æ®åº“æˆ–å…¨éƒ¨ä¿å­˜å¤±è´¥ã€‚å¦‚æœæŸäº›æ›´æ–°å®Œæˆï¼Œä¹‹åå‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹‹å‰å®Œæˆçš„æ›´æ–°å°†è‡ªåŠ¨å…¨éƒ¨å›æ»šã€‚å½“ä½ éœ€è¦å¯¹äº‹åŠ¡çš„æ›´å¤šçš„æ§åˆ¶æƒæ—¶â€”â€”æ¯”å¦‚æ‚¨æƒ³è¦åœ¨ä¸€æ¬¡äº‹åŠ¡ä¸­åŒ…å«åœ¨ Entity Framework ä¹‹å¤–çš„æ“ä½œâ€”â€”å‚è§[äº‹åŠ¡](https://docs.microsoft.com/ef/core/saving/transactions)ã€‚

## No-tracking æŸ¥è¯¢

å½“æ•°æ®åº“ä¸Šä¸‹æ–‡æ£€ç´¢æ•°æ®åº“è¡¨è¡Œå¹¶åˆ›å»ºå¯¹åº”çš„çš„å®ä½“å¯¹è±¡æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†è·Ÿè¸ªå†…å­˜ä¸­çš„å®ä½“æ˜¯å¦ä¸æ•°æ®åº“ä¸­çš„å®ä½“åŒæ­¥ã€‚ å†…å­˜ä¸­çš„æ•°æ®å……å½“ç¼“å­˜ï¼Œå¹¶åœ¨æ›´æ–°å®ä½“æ—¶ä½¿ç”¨ã€‚ è¿™ç§ç¼“å­˜åœ¨ Web åº”ç”¨ç¨‹åºä¸­é€šå¸¸æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºä¸Šä¸‹æ–‡å®ä¾‹é€šå¸¸æ˜¯çŸ­æš‚çš„ï¼ˆä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼‰ï¼Œå¹¶ä¸”ä¸Šä¸‹æ–‡é€šå¸¸ä¼šåœ¨å†æ¬¡è¯»å–è¯¥å®ä½“ä¹‹å‰è‡ªåŠ¨æ–½æ”¾ã€‚

æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ `AsNoTracking` æ–¹æ³•æ¥ç¦ç”¨å¯¹å†…å­˜ä¸­å®ä½“å¯¹è±¡çš„è·Ÿè¸ªã€‚ æ‚¨å¯ä»¥ä»¥ä¸‹å…¸å‹åœºæ™¯ä¸­ä½¿ç”¨ï¼š

* åœ¨ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸå†…ï¼Œæ‚¨ä¸éœ€è¦æ›´æ–°ä»»ä½•å®ä½“ï¼Œå¹¶ä¸”æ‚¨ä¸éœ€è¦ EF [é€šè¿‡å•ç‹¬æ£€ç´¢çš„å®ä½“è‡ªåŠ¨åŠ è½½å¯¼èˆªå±æ€§](read-related-data.md)ã€‚ è¿™äº›æ¡ä»¶é€šå¸¸åœ¨æ§åˆ¶å™¨çš„ HttpGet æ“ä½œæ–¹æ³•ä¸­å¾—åˆ°æ»¡è¶³ã€‚
 
* å¦‚æœæ‚¨æ­£åœ¨è¿è¡Œä¸€ä¸ªæ£€ç´¢å¤§æ•°æ®çš„æŸ¥è¯¢ï¼Œä½†æ˜¯åªæœ‰å¾ˆå°çš„ä¸€éƒ¨åˆ†è¿”å›çš„æ•°æ®å°†è¢«æ›´æ–°ã€‚ è¿™ä¸ªæ—¶å€™å…³é—­å¤§æ•°æ®æŸ¥è¯¢çš„è·Ÿè¸ªå¯èƒ½ä¼šæ›´æœ‰æ•ˆï¼Œå¹¶ä¸”ç¨åå•ç‹¬ä¸ºéœ€è¦æ›´æ–°çš„å‡ ä¸ªå®ä½“å†æ¬¡è¿è¡ŒæŸ¥è¯¢ã€‚
 
* æ‚¨æƒ³è¦é™„åŠ ä¸€ä¸ªå®ä½“æ¥æ›´æ–°å®ƒï¼Œä½†æ˜¯ä¹‹å‰æ‚¨å› ä¸ºä¸åŒçš„ç›®çš„æ£€ç´¢äº†åŒä¸€ä¸ªå®ä½“ã€‚ å› ä¸ºå®ä½“å·²è¢«æ•°æ®åº“ä¸Šä¸‹æ–‡è·Ÿè¸ªï¼Œæ‰€ä»¥æ‚¨ä¸èƒ½é™„åŠ è¦æ›´æ”¹çš„å®ä½“ã€‚ å¤„ç†è¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨ä¹‹å‰çš„æŸ¥è¯¢ä¸­è°ƒç”¨ `AsNoTracking` ã€‚

æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ [Tracking å¯¹æ¯” No-Tracking](https://docs.microsoft.com/en-us/ef/core/querying/tracking).

## æ€»ç»“

æ‚¨ç°åœ¨æ‹¥æœ‰ä¸€å¥—é’ˆå¯¹ Student å®ä½“å®Œæˆçš„ CRUD æ“ä½œçš„é¡µé¢ã€‚åœ¨ä¸‹ä¸€èŠ‚æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæ‰©å±• **Index** é¡µé¢å¢åŠ æ’åºï¼Œåˆ†ç»„ï¼Œè¿‡æ»¤ä»¥åŠåˆ†é¡µçš„åŠŸèƒ½ã€‚

>[!div class="step-by-step"]
[ä¸Šä¸€èŠ‚](intro.md)
[ä¸‹ä¸€èŠ‚](sort-filter-page.md)  
